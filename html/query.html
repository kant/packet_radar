<html>
<body>
<style>
        body {
            font-family: monospace;
        }
        #holder {
            width: 100%;
            height: 100%;
        }

        .item {
            width: 100%;
            height: 20px;   
        }
    </style>

    <script src="js/packet_server.js"></script>
    <script src="js/stats.js"></script>
    <script src="js/links.js"></script>

    <h2>Top</h2>
    <div id="holder">
    
    <script>

        var ips = new Map();
        var local_ips = new Set();
        
        function check_host(ip) {
            if (!ips.has(ip)) {
                ips.set(ip, null);

                console.log('query ', ip);
                query_lookup(ip);
            }
        }

        function query_lookup(ip) {
            ws.send(JSON.stringify({req: 'lookup', value: ip, type: ''}));
        }

        function query_host_ip() {
            ws.send(JSON.stringify({req: 'local_addr', value: '', type: ''}))
        }

        connect_packet_server(data => {
            if (data.type === 'lookup_addr') {
                console.log(data);
                ips.set(data.ip, data.hostname);
                return;
            } else if (data.type === 'local_addr') {
                console.log('ip', data);
                local_ips.add(data.ip);
                return;
            }
            const { src, dest, len, src_port, dest_port } = data;

            check_host(src);
            check_host(dest);
        });

        setTimeout(() => {
            query_host_ip();
        }, 1000);

    </script>
</body>
</html>